{% extends "common/layout_base.html" %}

{% block page_title %}Leave Center{% endblock %}

{% block content %}
<style>
/* =========================================
   REFINED COMPACT DASHBOARD
   ========================================= */

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --surface: #ffffff;
  --bg: #f8fafc;
}

body {
  background-color: var(--bg);
  color: #1e293b;
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

/* Entrance Animations */
@keyframes slideUpFade {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

.anim-1 { animation: slideUpFade 0.4s ease forwards; }
.anim-2 { animation: slideUpFade 0.5s ease forwards; opacity: 0; }
.anim-3 { animation: slideUpFade 0.6s ease forwards; opacity: 0; }

/* Dashboard Layout */
.dash-container {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 1.25rem;
  max-width: 1100px;
  margin: 2.5rem auto;
  padding: 0 1rem;
}

@media (max-width: 900px) {
  .dash-container { grid-template-columns: 1fr; margin: 1rem auto; }
}

/* Card Styling */
.glass-card {
  background: var(--surface);
  border: 1px solid rgba(226, 232, 240, 0.8);
  border-radius: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -1px rgba(0, 0, 0, 0.01);
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
}

.glass-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 20px -8px rgba(0, 0, 0, 0.05);
}

/* Vivid Balance Card */
.balance-card {
  background: linear-gradient(135deg, #305969 0%, #115577 100%);
  color: white;
  position: relative;
  overflow: hidden;
}

.balance-card::after {
  content: '';
  position: absolute;
  top: -20%; right: -10%;
  width: 120px; height: 120px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
}

/* Modern Inputs */
.modern-input {
  width: 100%;
  background: #f1f5f9;
  border: 2px solid transparent;
  border-radius: 0.85rem;
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  font-weight: 600;
  transition: all 0.2s ease;
}

.modern-input:focus {
  outline: none;
  background: white;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

/* History Rows */
.history-item {
  border-bottom: 1px solid #f1f5f9;
  padding: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: background 0.2s ease;
}

.history-item:hover { background: #f8fafc; }

.status-badge {
  font-size: 0.65rem;
  font-weight: 800;
  padding: 0.35rem 0.75rem;
  border-radius: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.badge-Approved { background: #dcfce7; color: #166534; }
.badge-Pending { background: #fef3c7; color: #92400e; }
.badge-Rejected { background: #fee2e2; color: #991b1b; }

</style>

<div class="dash-container">
  
  <aside class="space-y-0">
    <div class="glass-card balance-card p-7 anim-1">
      <div class="relative z-10">
        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] opacity-80">Available Entitlement</h4>
        <div class="flex items-baseline gap-1 mt-2">
          <span class="text-5xl font-black">{{ leave_balance|default(0) }}</span>
          <span class="text-sm font-bold opacity-70">Days</span>
        </div>
        
        <div class="mt-6 flex items-center justify-between">
           <div class="text-[10px] font-bold">Progress: {{ 30 - leave_balance|default(0) }} Used</div>
           <div class="w-20 h-1.5 bg-black/20 rounded-full overflow-hidden">
              <div class="h-full bg-white transition-all duration-1000" style="width: {{ (leave_balance|default(0) / 30) * 100 }}%"></div>
           </div>
        </div>
      </div>
    </div>

    <div class="glass-card p-6 anim-2 ">
      <div class="flex items-center gap-2 mb-6">
        <div class="w-2 h-6 bg-indigo-500 rounded-full"></div>
        <h3 class="font-bold text-slate-800">Apply Leave</h3>
      </div>
      
      <form method="post" action="/employee/leave/apply" class="space-y-5">
        <div class="grid grid-cols-1 gap-4">
          <div class="space-y-1">
            <label class="text-[10px] font-extrabold text-slate-400 uppercase tracking-widest ml-1">Start Date</label>
            <input type="date" name="start_date" required class="modern-input">
          </div>
          <div class="space-y-1">
            <label class="text-[10px] font-extrabold text-slate-400 uppercase tracking-widest ml-1">End Date</label>
            <input type="date" name="end_date" required class="modern-input">
          </div>
        </div>

        <div class="space-y-1">
          <label class="text-[10px] font-extrabold text-slate-400 uppercase tracking-widest ml-1">Reason</label>
          <textarea name="reason" rows="3" required class="modern-input resize-none" placeholder="Brief description..."></textarea>
        </div>

        <button class="w-full bg-slate-900 text-white py-3.5 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-indigo-600 active:scale-95 transition-all shadow-lg shadow-slate-200">
          Confirm Request
        </button>
      </form>
    </div>
  </aside>

  <main class="glass-card flex flex-col h-[650px] anim-3">
    <div class="px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-white/50 backdrop-blur-md sticky top-0 z-20">
      <div>
        <h2 class="text-lg font-black text-slate-800">Application Records</h2>
        <div class="flex items-center gap-2 mt-1">
            <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Live Database Tracking</p>
        </div>
      </div>
      
      <!-- <div class="flex gap-2">
         <div class="h-8 w-8 rounded-lg bg-slate-50 flex items-center justify-center text-slate-400 hover:text-indigo-600 transition-colors cursor-pointer">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4.5h18m-18 5h18m-18 5h18m-18 5h18"/></svg>
         </div>
      </div> -->
    </div>

    <div class="flex-1 overflow-y-auto custom-scroll">
      {% if leaves %}
        {% for l in leaves %}
        <div class="history-item group">
          <div class="flex items-center gap-5">
            <div class="w-12 h-12 rounded-2xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center transition-all group-hover:bg-indigo-50 group-hover:border-indigo-100">
               <span class="text-base font-black text-slate-700 group-hover:text-indigo-600">{% if l.start_date and l.end_date %}{{ (l.end_date - l.start_date).days + 1 }}{% else %}1{% endif %}</span>
               <span class="text-[8px] font-bold text-slate-400 uppercase leading-none">Days</span>
            </div>
            
            <div>
              <div class="flex items-center gap-2">
                <span class="text-sm font-bold text-slate-800">{{ l.start_date }}</span>
                <svg class="w-3 h-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
                <span class="text-sm font-bold text-slate-800">{{ l.end_date }}</span>
              </div>
              <p class="text-xs text-slate-400 font-medium mt-0.5 max-w-[300px] truncate italic">"{{ l.reason }}"</p>
            </div>
          </div>

          <div class="flex items-center gap-6">
            <span class="status-badge badge-{{ l.status }}">{{ l.status }}</span>
            <button class="p-2 text-slate-300 hover:text-slate-600 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="h-full flex flex-col items-center justify-center">
          <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4">
             <svg class="w-8 h-8 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/></svg>
          </div>
          <p class="text-xs font-black text-slate-300 uppercase tracking-widest">No activity found</p>
        </div>
      {% endif %}
    </div>
  </main>
</div>

<script>
  (function () {
    const s = document.querySelector('input[name="start_date"]');
    const e = document.querySelector('input[name="end_date"]');
    const today = new Date().toISOString().split('T')[0];
    s.min = today;
    s.addEventListener('change', () => {
      e.min = s.value;
      if(e.value && e.value < s.value) e.value = s.value;
    });
  })();
</script>
{% endblock %}