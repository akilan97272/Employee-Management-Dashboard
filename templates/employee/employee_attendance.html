{% extends "common/layout_base.html" %}
{% block title %}My Attendance{% endblock %}
{% block content %}

<style>
/* =========================================
   REFINED ATTENDANCE SYSTEM UI
   ========================================= */

:root {
  --glass-bg: rgba(255, 255, 255, 0.7);
  --glass-border: rgba(255, 255, 255, 0.4);
  --accent-blue: #3b82f6;
  --slate-900: #0f172a;
}

body {
  background: radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.02) 0px, transparent 50%),
              radial-gradient(at 100% 100%, rgba(99, 102, 241, 0.02) 0px, transparent 50%);
  background-color: #f8fafc;
}

/* Glass Card */
.att-card {
  background: var(--glass-bg);
  backdrop-filter: blur(12px) saturate(160%);
  border: 1px solid var(--glass-border);
  box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.04);
  transition: all 0.4s ease;
}

/* Timeline Logic */
.log-row {
  position: relative;
  border-left: 4px solid #e2e8f0;
  transition: all 0.3s ease;
}

.log-row:hover {
  border-left-color: var(--accent-blue);
  background: white;
  transform: translateX(4px);
}

.status-badge {
  font-size: 0.65rem;
  font-weight: 800;
  padding: 4px 12px;
  border-radius: 9999px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Animated Presence Indicator */
.presence-ring {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.presence-ring::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #10b981;
  opacity: 0.2;
  animation: ripple 2s infinite;
}

@keyframes ripple {
  0% { transform: scale(1); opacity: 0.4; }
  100% { transform: scale(2.5); opacity: 0; }
}

/* Custom Scrollbar for list */
.history-container {
  max-height: 600px;
  overflow-y: auto;
}
.history-container::-webkit-scrollbar { width: 6px; }
.history-container::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }

.kpi-label {
  font-size: 0.65rem;
  font-weight: 800;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

</style>

<div class="max-w-7xl mx-auto p-6 space-y-8">

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="att-card rounded-3xl p-6 fade-in">
      <p class="kpi-label mb-2">Total Productive Time</p>
      <div class="flex items-baseline gap-2">
        <span class="text-4xl font-black text-slate-900">{{ total_hours }}</span>
        <span class="text-sm font-bold text-slate-400">HRS</span>
      </div>
    </div>


    <button type="submit" class="w-full md:w-auto px-8 py-2.5 bg-slate-900 text-white font-semibold rounded-lg hover:bg-slate-800 transition-all shadow-lg shadow-slate-200">
      Filter Records
    </button>
  </form>

  <div class="att-card p-8 fade-in delay-2 rounded-xl ">
    <div class="flex justify-between items-center mb-8 ">
      <h3 class="text-xl font-bold text-slate-900">Attendance History</h3>
      <span class="text-xs font-semibold px-3 py-1 bg-slate-100 text-slate-600 rounded-full uppercase tracking-wider">
        {{ logs|length }} Logs Found
      </span>
    </div>

    <div class="space-y-3">
      {% if logs %}
        {% for a in logs %}
        <div class="log-row p-5 flex flex-col md:flex-row md:items-center justify-between gap-4">
          
          <div class="flex items-center gap-4">
            <div class="h-12 w-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <div>
              <p class="font-bold text-slate-900 text-lg">
                {{ a.entry_time.strftime("%d %b %Y") }}
              </p>
              <p class="text-sm text-slate-500 font-medium">
                {{ a.entry_time.strftime("%I:%M %p") }} 
                <span class="mx-2 text-slate-300">|</span> 
                {% if a.exit_time %}
                  {{ a.exit_time.strftime("%I:%M %p") }}
                {% else %}
                  <span class="text-emerald-600 font-bold">Currently On-site</span>
                {% endif %}
              </p>
            </div>
          </div>

          <div class="flex flex-col md:items-end">
            <div class="flex items-center gap-2 mb-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span class="text-sm font-semibold text-slate-700">{{ a.location_name }} ({{ a.room_no }})</span>
            </div>
            
            {% if a.duration %}
              <div class="text-lg font-black text-slate-900">
                {{ "%.2f"|format(a.duration) }} <span class="text-xs font-bold text-slate-400 uppercase">hrs</span>
              </div>
            {% endif %}
          </div>
          
=======
    <div class="att-card rounded-3xl p-6 fade-in delay-1 bg-gradient-to-br from-white to-blue-50/30">
      <p class="kpi-label mb-2 text-blue-600">This Month</p>
      <div class="flex items-baseline gap-2">
        <span class="text-4xl font-black text-blue-600" id="month-hours">
            <span class="animate-pulse text-slate-200">...</span>
        </span>
        <span class="text-sm font-bold text-blue-300">HRS</span>
      </div>
    </div>

    <div class="att-card rounded-3xl p-6 fade-in delay-2 flex items-center justify-between">
      <div>
        <p class="kpi-label mb-2">Live Status</p>
        <span class="text-2xl font-black text-slate-800">
            {% if logs and not logs[0].exit_time %}Active{% else %}Offline{% endif %}
        </span>
      </div>
      {% if logs and not logs[0].exit_time %}
        <div class="presence-ring">
            <div class="h-4 w-4 bg-emerald-500 rounded-full relative z-10 border-2 border-white"></div>
>>>>>>> af99fe0a31ca150f52879d997c73f7e576735816
        </div>
      {% else %}
<<<<<<< HEAD
        <div class="text-center py-20">
          <div class="text-slate-300 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <p class="text-slate-500 font-medium">No data available</p>
        </div>
=======
        <div class="h-4 w-4 bg-slate-300 rounded-full border-2 border-white"></div>
>>>>>>> af99fe0a31ca150f52879d997c73f7e576735816
      {% endif %}
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
    
    <div class="lg:col-span-1 space-y-4 fade-in delay-3">
        <div class="att-card rounded-[2rem] p-6">
            <h3 class="text-sm font-black text-slate-800 mb-6 flex items-center gap-2 uppercase tracking-tight">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
                Filter History
            </h3>
            <div class="space-y-4">
                <div>
                    <label class="kpi-label mb-2 block">Start Date</label>
                    <input type="date" class="w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-2.5 text-sm font-bold focus:ring-4 focus:ring-blue-50 outline-none transition-all">
                </div>
                <div>
                    <label class="kpi-label mb-2 block">End Date</label>
                    <input type="date" class="w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-2.5 text-sm font-bold focus:ring-4 focus:ring-blue-50 outline-none transition-all">
                </div>
                <button class="w-full py-3 bg-slate-900 text-white rounded-xl font-bold text-sm hover:bg-blue-600 transition-all shadow-lg shadow-slate-200">
                    Update View
                </button>
            </div>
        </div>
    </div>

    <div class="lg:col-span-3 space-y-4 fade-in delay-2">
      <div class="att-card rounded-[2rem] p-8">
        <div class="flex justify-between items-center mb-8">
            <h3 class="text-xl font-black text-slate-800 tracking-tight">Activity Log</h3>
            <span class="status-badge bg-blue-50 text-blue-600 border border-blue-100">{{ logs|length }} Logs</span>
        </div>

        <div class="history-container space-y-3 px-1">
          {% if logs %}
            {% for a in logs %}
            <div class="log-row p-5 bg-white/40 rounded-2xl flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div class="flex items-center gap-5">
                <div class="text-center min-w-[60px]">
                    <p class="text-xs font-black text-slate-400 uppercase tracking-tighter">{{ a.entry_time.strftime("%b") }}</p>
                    <p class="text-2xl font-black text-slate-900 leading-none">{{ a.entry_time.strftime("%d") }}</p>
                </div>
                <div class="h-10 w-px bg-slate-100 hidden md:block"></div>
                <div>
                  <div class="flex items-center gap-3 mb-1">
                    <p class="font-black text-slate-800">{{ a.entry_time.strftime("%I:%M %p") }}</p>
                    <svg class="w-3 h-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                    {% if a.exit_time %}
                      <p class="font-black text-slate-800">{{ a.exit_time.strftime("%I:%M %p") }}</p>
                    {% else %}
                      <span class="status-badge bg-emerald-50 text-emerald-600 animate-pulse">On-site</span>
                    {% endif %}
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-[10px] font-black px-2 py-0.5 bg-slate-100 text-slate-500 rounded uppercase tracking-widest">{{ a.location_name }}</span>
                    <span class="text-[10px] font-bold text-slate-300">Room {{ a.room_no }}</span>
                  </div>
                </div>
              </div>

              {% if a.duration %}
              <div class="bg-slate-900 px-4 py-2 rounded-xl text-center md:text-right">
                <p class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Duration</p>
                <p class="text-lg font-black text-white leading-tight">
                    {{ "%.2f"|format(a.duration) }} <small class="text-[10px] text-slate-400">HRS</small>
                </p>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          {% else %}
            <div class="py-20 text-center">
                <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-100">
                    <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">No activity found</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center py-6">
    <p class="text-[10px] font-black text-slate-300 uppercase tracking-[0.3em]">Corporate Attendance Engine â€¢ Secure Session</p>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  fetch("/api/month-hours")
    .then(res => res.json())
    .then(data => {
      const display = document.getElementById("month-hours");
      if(data.total_hours !== undefined) {
        display.textContent = data.total_hours;
      }
    })
    .catch(err => {
      document.getElementById("month-hours").textContent = "--";
    });
});
</script>

{% endblock %}
