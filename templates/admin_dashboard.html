{% extends "layout_base.html" %}
{% block title %}Admin Dashboard — TeamSync{% endblock %}
{% block sidebar %}{% include "sidebar_admin.html" %}{% endblock %}
{% block page_title %}Admin Command Center{% endblock %}

{% block content %}

<!-- =============================== -->
<!-- OVERVIEW CARDS -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Overview</h3>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">

  <!-- Total Employees -->
  <div class="glass p-4 rounded-lg text-center">
    <div class="text-3xl font-bold">{{ employees|length }}</div>
    <div class="muted text-sm">Total Employees</div>
  </div>

  <!-- Active Rooms -->
  <div class="glass p-4 rounded-lg text-center">
    <div class="text-3xl font-bold text-green-400">{{ blocks|length }}</div>
    <div class="muted text-sm">Active Rooms</div>
  </div>

  <!-- Unknown RFID Alerts -->
  <div class="glass p-4 rounded-lg text-center">
    <div class="text-3xl font-bold text-red-400">{{ unknown_rfids|length }}</div>
    <div class="muted text-sm">Unknown RFID Attempts</div>
  </div>

  <!-- Departments -->
  <div class="glass p-4 rounded-lg text-center">
    <div class="text-3xl font-bold">
      {{ departments|length if departments else 3 }}
    </div>
    <div class="muted text-sm">Departments</div>
  </div>

  <!-- Active Projects -->
  <div class="glass p-4 rounded-lg text-center col-span-2 md:col-span-1">
    <div class="text-3xl font-bold">
      {{ active_projects }}
    </div>
    <div class="muted text-sm">Active Projects</div>
  </div>

</div>



<!-- =============================== -->
<!-- LIVE ROOM STATUS -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Live Room Status</h3>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-10">
  {% for b in blocks %}
  <div class="glass p-4 rounded-lg">
    <div class="font-semibold text-lg">{{ b.location_name }}</div>
    <div class="muted text-sm">Room {{ b.room_no }}</div>

    {% if b.count > 0 %}
      <div class="text-green-400 text-xl font-bold mt-2">{{ b.count }} Present</div>
    {% else %}
      <div class="text-gray-400 text-xl font-bold mt-2">0 Present</div>
    {% endif %}
  </div>
  {% endfor %}

  {% if blocks|length == 0 %}
  <div class="muted">No active rooms right now.</div>
  {% endif %}
</div>



<!-- =============================== -->
<!-- PROJECT PROGRESS -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Project Progress</h3>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-10">

  {% for p in projects %}
  <div class="glass p-4 rounded-lg">

    <div class="font-semibold text-lg">{{ p.name }}</div>
    <div class="muted text-sm">Deadline: {{ p.deadline }}</div>

    <div class="w-full bg-white/10 rounded h-2 mt-3">
      <div class="bg-green-400 h-2 rounded" style="width: {{ p.progress }}%;"></div>
    </div>

    <div class="text-sm mt-1">{{ p.progress }}% completed</div>

  </div>
  {% endfor %}

  {% if projects|length == 0 %}
  <div class="muted">No active projects found.</div>
  {% endif %}
</div>



<!-- =============================== -->
<!-- DEPARTMENT BREAKDOWN -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Department Breakdown</h3>

<div class="glass p-5 rounded-lg mb-10">

  {% set dept_count = {} %}
  {% for e in employees %}
    {% set _ = dept_count.update({ e.department: (dept_count.get(e.department, 0) + 1) }) %}
  {% endfor %}

  {% for dept, count in dept_count.items() %}
    <div class="mb-3">
      <div class="flex justify-between">
        <span class="font-medium">{{ dept }}</span>
        <span>{{ count }}</span>
      </div>

      <div class="w-full bg-white/10 rounded h-2 mt-1">
        <div class="bg-blue-400 h-2 rounded" style="width: {{ (count / employees|length) * 100 }}%;"></div>
      </div>
    </div>
  {% endfor %}

  {% if dept_count|length == 0 %}
    <div class="muted text-sm">No departments found.</div>
  {% endif %}
</div>



<!-- =============================== -->
<!-- RECENT ACTIVITY -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Recent Activity</h3>

<div class="glass p-4 rounded-lg mb-10">

  {% if recent %}
    {% for r in recent %}
      <div class="p-3 border-b border-white/10">
        <div class="font-medium">{{ r.employee_id }} — Room {{ r.room_no }}</div>

        {% if r.exit_time %}
          <div class="muted text-sm">Exited at {{ r.exit_time.strftime("%H:%M:%S") }}</div>
        {% else %}
          <div class="text-green-400 text-sm">
            Present (Entered {{ r.entry_time.strftime("%H:%M:%S") }})
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <div class="muted text-sm">No recent activity.</div>
  {% endif %}

</div>



<!-- =============================== -->
<!-- QUICK ACTIONS -->
<!-- =============================== -->
<h3 class="font-semibold mb-3">Quick Actions</h3>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4">

  <a href="/admin/manage_employees"
     class="glass p-4 rounded-lg text-center font-medium hover:bg-white/10">
    Manage Employees
  </a>

  <a href="/admin/unknown_rfid"
     class="glass p-4 rounded-lg text-center text-red-400 font-medium hover:bg-white/10">
    View Unknown RFID
  </a>

  <a href="/admin/attendance"
     class="glass p-4 rounded-lg text-center font-medium hover:bg-white/10">
    Attendance Logs
  </a>

  <a href="/admin/payroll"
     class="glass p-4 rounded-lg text-center font-medium hover:bg-white/10">
    Payroll Summary
  </a>

  <a href="/admin/projects"
     class="glass p-4 rounded-lg text-center font-medium hover:bg-white/10">
    Manage Projects
  </a>

</div>

{% endblock %}
