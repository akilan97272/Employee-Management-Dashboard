{% extends "layout_base.html" %}
{% block sidebar %}{% include "sidebar_admin.html" %}{% endblock %}
{% block page_title %}Manage Employees{% endblock %}

{% block content %}
<div class="space-y-4">

  <!-- Search + Filter -->
  <form method="get" action="/admin/manage_employees"
        class="flex gap-3 glass p-4 rounded-lg">
    <input name="search" placeholder="Search by name or ID"
           class="flex-1 p-2 rounded border" value="{{ search or '' }}"/>

    <select name="department" class="p-2 rounded border">
      <option value="">All Departments</option>
      <option value="IT">IT</option>
      <option value="HR">HR</option>
      <option value="Finance">Finance</option>
    </select>

    <button class="px-4 bg-accent text-white rounded">Search</button>
  </form>

  <!-- Employees Table -->
  <div class="glass p-4 rounded-lg overflow-x-auto">
    <table class="w-full text-left text-sm">
      <thead class="border-b font-semibold">
        <tr>
          <th class="p-2">ID</th>
          <th class="p-2">Name</th>
          <th class="p-2">Department</th>
          <th class="p-2">Role</th>
          <th class="p-2"></th>
        </tr>
      </thead>
      <tbody>
      {% for emp in employees %}
        <tr class="border-b hover:bg-gray-100/20">
          <td class="p-2">{{ emp.employee_id }}</td>
          <td class="p-2">{{ emp.name }}</td>
          <td class="p-2">{{ emp.department }}</td>
          <td class="p-2">{{ emp.role }}</td>
          <td class="p-2 flex gap-2">
            <button class="glass px-3 py-1 rounded"
                    onclick="openEditModal('{{ emp.employee_id }}', '{{ emp.name }}', '{{ emp.email }}', '{{ emp.department }}', '{{ emp.role }}')">
              ✏️ Edit
            </button>
            <form action="/admin/remove_employee" method="post"
                  onsubmit="return confirm('Remove this employee?')">
              <input type="hidden" name="employee_id" value="{{ emp.employee_id }}">
              <button class="bg-red-500 text-white px-3 py-1 rounded">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

</div>


<!-- Edit Modal -->
<div id="editModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
  <div class="glass p-6 rounded-xl w-80">
    <h3 class="font-semibold text-lg mb-3">Edit Employee</h3>

    <form method="post" action="/admin/update_employee" class="grid gap-3">

      <input type="hidden" id="edit_employee_id" name="employee_id"/>

      <input id="edit_name" name="name" placeholder="Full Name"
             class="p-2 rounded border bg-white"/>

      <input id="edit_email" name="email" placeholder="Email"
             class="p-2 rounded border bg-white"/>

      <select id="edit_department" name="department"
              class="p-2 rounded border bg-white">
        <option>IT</option>
        <option>HR</option>
        <option>Finance</option>
      </select>

      <select id="edit_role" name="role"
              class="p-2 rounded border bg-white">
        <option>employee</option>
        <option>admin</option>
      </select>

      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeModal()" class="glass px-3 py-1 rounded">Cancel</button>
        <button class="bg-accent text-white px-3 py-1 rounded">Save</button>
      </div>

    </form>
  </div>
</div>


<script>
function openEditModal(id, name, email, dept, role){
  document.getElementById("edit_employee_id").value = id;
  document.getElementById("edit_name").value = name;
  document.getElementById("edit_email").value = email;
  document.getElementById("edit_department").value = dept;
  document.getElementById("edit_role").value = role;
  document.getElementById("editModal").classList.remove("hidden");
}
function closeModal(){
  document.getElementById("editModal").classList.add("hidden");
}
</script>

{% endblock %}
